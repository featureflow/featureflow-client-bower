/*!
 * Featureflow Client v0.2.4
 * Web: https://www.featureflow.io/
 * Date: 2017-03-23T06:17:39.829Z
 * Licence: Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Featureflow=t():e.Featureflow=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";var r="LOADED",i="ERROR",a="UPDATED_FEATURE";t.a={LOADED:r,ERROR:i,UPDATED_FEATURE:a}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){try{return JSON.parse(localStorage.getItem("ff:"+t+":"+e)||"{}")}catch(e){return{}}}function a(e,t,n){return localStorage.setItem("ff:"+t+":"+e,JSON.stringify(n))}var o=n(4),s=n(3),u=n(0),c=n(5),f=n.n(c),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h={key:"anonymous"},d="https://app.featureflow.io",v="https://rtm.featureflow.io",y={baseUrl:d,rtmUrl:v,streaming:!0,defaultFeatures:{}},b=new Error("init() has not been called with a valid apiKey"),m=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,e),this.emitter=new f.a,this.apiKey=t,!this.apiKey)throw b;if(this.config=l({},y,s),this.updateContext(i),this.config.streaming){var c=new window.EventSource(this.config.rtmUrl+"/api/js/v1/stream/"+this.apiKey);c.onmessage=function(e){var t=[];try{t=JSON.parse(e.data)}catch(e){}o.a.getFeatures(n.config.baseUrl,n.apiKey,n.context,t,function(e,t){e?n.emitter.emit(u.a.ERROR,e):(n.features=l({},n.features,t),a(n.apiKey,n.context.key,n.features),n.emitter.emit(u.a.UPDATED_FEATURE,t))})}}this.on=this.emitter.on.bind(this.emitter),this.off=this.emitter.off.bind(this.emitter)}return p(e,[{key:"updateContext",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.context={key:t.key||h.key,values:t.values},this.features=i(this.apiKey,this.context.key),o.a.getFeatures(this.config.baseUrl,this.apiKey,this.context,[],function(t,n){t?e.emitter.emit(u.a.ERROR,t):(e.features=n||{},a(e.apiKey,e.context.key,e.features),e.emitter.emit(u.a.LOADED,n))}),this.context}},{key:"getFeatures",value:function(){return this.features}},{key:"getContext",value:function(){return this.context}},{key:"evaluate",value:function(e){return new s.a(this.features[e]||this.config.defaultFeatures[e]||"off")}},{key:"goal",value:function(e){return o.a.postGoalEvent(this.config.baseUrl,this.apiKey,e,this.getFeatures(),function(e,t){})}}]),e}();t.a=m},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.storedValue=t.toLowerCase()}return i(e,[{key:"value",value:function(){return this.storedValue}},{key:"is",value:function(e){return e.toLowerCase()===this.value().toLowerCase()}},{key:"isOn",value:function(){return this.is("on")}},{key:"isOff",value:function(){return this.is("off")}}]),e}();t.a=a},function(e,t,n){"use strict";function r(e,t,n){var r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&"application/json;charset=UTF-8"===r.getResponseHeader("Content-type")?n(null,JSON.parse(r.responseText)):n(r.statusText)}),r.addEventListener("error",function(){n(r.statusText)}),r.open(t.method,e),r.setRequestHeader("X-Featureflow-Client","javascript-"+o.a.version),t.body?(r.setRequestHeader("ContentType","application/json"),r.send(JSON.stringify(t.body))):r.send(),r}function i(e){return btoa(JSON.stringify(e))}var a=n(6),o=n.n(a);t.a={getFeatures:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments[4],s=a.length>0?"?keys="+a.join(","):"";r(e+"/api/js/v1/evaluate/"+t+"/context/"+encodeURI(i(n))+s,{method:"GET"},o)},postGoalEvent:function(e,t,n,i,a){r(e+"/api/js/v1/goalevent/"+t,{method:"POST",body:{key:n,hits:1,evaluated:i}},a)}}},function(e,t){function n(){}n.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){i.off(e,r),t.apply(n,arguments)}var i=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var a=0,o=r.length;a<o;a++)r[a].fn!==t&&r[a].fn._!==t&&i.push(r[a]);return i.length?n[e]=i:delete n[e],this}},e.exports=n},function(e,t){e.exports={name:"featureflow-client",version:"0.2.4",description:"Featureflow Javascipt Client",author:"Featureflow <featureflow@featureflow.io>",license:"Apache-2.0",keywords:["featureflow","feature","analytics","client"],files:["dist"],repository:{type:"git",url:"git+https://github.com/featureflow/featureflow-javascript-sdk.git"},main:"dist/featureflow",scripts:{"build-lib":"webpack src/index.js dist/featureflow.js","build-min":"webpack -p src/index.js dist/featureflow.min.js",build:"node ./scripts/build.js",watch:"webpack --watch src/index.js dist/featureflow.js",test:"karma start --single-run","test:watch":"karma start --auto-watch --reporters=dots",prepublish:"node ./scripts/prepublish.js",flow:"flow",example:"webpack-dev-server --config ./example/webpack.config.js --content-base example/ --inline --port 8182"},devDependencies:{babel:"^6.23.0","babel-core":"^6.23.1","babel-loader":"^6.3.0","babel-plugin-transform-flow-strip-types":"^6.22.0","babel-plugin-transform-object-rest-spread":"^6.23.0","babel-preset-es2015":"^6.22.0",chai:"3.5.0","css-loader":"^0.26.1","file-loader":"^0.10.0","flow-bin":"^0.39.0","gzip-size":"3.0.0","html-webpack-plugin":"^2.28.0","in-publish":"2.0.0",karma:"0.13.22","karma-chai":"0.1.0","karma-chrome-launcher":"1.0.1","karma-mocha":"1.0.1","karma-mocha-reporter":"2.0.4","karma-phantomjs-launcher":"0.2.1","karma-phantomjs-shim":"1.1.2","karma-sinon":"1.0.5","karma-sourcemap-loader":"0.3.7","karma-webpack":"2.0.2",mocha:"2.5.3",phantomjs:"1.9.18","pretty-bytes":"3.0.1","readline-sync":"1.4.4","semver-compare":"^1.0.0",sinon:"1.17.4","style-loader":"^0.13.1",webpack:"2.2.1","webpack-dev-server":"^2.3.0"},dependencies:{"tiny-emitter":"^1.1.0"}}},function(e,t,n){"use strict";(function(e){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new i.a(e,t,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(0);t.init=r,n.d(t,"events",function(){return o});var o=a.a;t.default={init:r,events:o},void 0!==window.VERSION&&(e.exports.version=window.VERSION)}).call(t,n(2)(e))}])});