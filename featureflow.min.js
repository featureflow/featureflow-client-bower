!function(e){"use strict";function t(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=new XMLHttpRequest;return o.addEventListener("load",function(){200===o.status&&"application/json;charset=UTF-8"===o.getResponseHeader("Content-Type")?n(null,JSON.parse(o.responseText)):n(o.statusText||"non 200 response status code")}),o.addEventListener("error",function(){n("error connecting with server")}),o.open(t.method,e),o.setRequestHeader("X-Featureflow-Client","javascript-"+c.version),t.body?(o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t.body))):o.send(),o}function n(e){return btoa(JSON.stringify(e))}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){try{return JSON.parse(localStorage.getItem("ff:"+t+":"+e)||"{}")}catch(e){return{}}}function s(e,t,n){return localStorage.setItem("ff:"+t+":"+e,JSON.stringify(n))}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new w(e,t,n)}var c={name:"featureflow-client",version:"0.7.2",description:"Featureflow Javascipt Client",author:"Featureflow <featureflow@featureflow.io>",license:"Apache-2.0",keywords:["featureflow","feature","analytics","client"],files:["dist"],repository:{type:"git",url:"git+https://github.com/featureflow/featureflow-javascript-sdk.git"},main:"dist/featureflow.umd",scripts:{"build-bower":"rollup -c","build-lib":"webpack src/index.js dist/featureflow.umd.js","build-min":"webpack -p src/index.js dist/featureflow.umd.min.js",build:"node ./scripts/build.js",watch:"webpack --watch src/index.js dist/featureflow.umd.js",test:"karma start --single-run","test:watch":"karma start --auto-watch --reporters=dots",prepublish:"node ./scripts/build.js","publish:bower":"node ./scripts/bower.js",flow:"flow",example:"webpack-dev-server --config ./example/webpack.config.js --content-base example/ --inline --port 8182"},devDependencies:{babel:"^6.23.0","babel-core":"^6.23.1","babel-loader":"^6.3.0","babel-plugin-transform-flow-strip-types":"^6.22.0","babel-plugin-transform-object-rest-spread":"^6.23.0","babel-preset-es2015":"^6.22.0",chai:"3.5.0","css-loader":"^0.26.1","file-loader":"^0.10.0","flow-bin":"^0.39.0","gzip-size":"3.0.0","html-webpack-plugin":"^2.28.0","in-publish":"2.0.0",karma:"0.13.22","karma-chai":"0.1.0","karma-chrome-launcher":"1.0.1","karma-mocha":"1.0.1","karma-mocha-reporter":"2.0.4","karma-phantomjs-launcher":"0.2.1","karma-phantomjs-shim":"1.1.2","karma-sinon":"1.0.5","karma-sourcemap-loader":"0.3.7","karma-webpack":"2.0.2",mocha:"2.5.3",phantomjs:"1.9.18","pretty-bytes":"3.0.1","readline-sync":"1.4.4",rollup:"^0.43.0","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.0","rollup-plugin-uglify":"^2.0.1","semver-compare":"^1.0.0",sinon:"1.17.4","style-loader":"^0.13.1",webpack:"2.2.1","webpack-dev-server":"^2.3.0"},dependencies:{"js-cookie":"^2.1.3","tiny-emitter":"^1.1.0"}},l={getFeatures:function(e,o,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments[4],s=r.length>0?"?keys="+r.join(","):"";t(e+"/api/js/v1/evaluate/"+o+"/context/"+encodeURI(n(i))+s,{method:"GET"},a)},postGoalEvent:function(e,n,o,i,r,a){t(e+"/api/js/v1/event/"+n,{method:"POST",body:[{type:"goal",data:{contextKey:o,goalKey:i,hits:1,evaluated:r}}]},a)},postEvaluateEvent:function(e,n,o,i,r,a){t(e+"/api/js/v1/event/"+n,{method:"POST",body:[{type:"evaluate",data:{contextKey:o,featureKey:i,variant:r,hits:1}}]},a)}},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=function(){function e(t){o(this,e),this.storedValue=t.toLowerCase()}return f(e,[{key:"value",value:function(){return this.storedValue}},{key:"is",value:function(e){return e.toLowerCase()===this.value().toLowerCase()}},{key:"isOn",value:function(){return this.is("on")}},{key:"isOff",value:function(){return this.is("off")}}]),e}(),h={INIT:"INIT",LOADED:"LOADED",LOADED_FROM_CACHE:"LOADED_FROM_CACHE",ERROR:"ERROR",UPDATED_FEATURE:"UPDATED_FEATURE"};i.prototype={on:function(e,t,n){var o=this.e||(this.e={});return(o[e]||(o[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function o(){i.off(e,o),t.apply(n,arguments)}var i=this;return o._=t,this.on(e,o,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),o=0,i=n.length;for(o;o<i;o++)n[o].fn.apply(n[o].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),o=n[e],i=[];if(o&&t)for(var r=0,a=o.length;r<a;r++)o[r].fn!==t&&o[r].fn._!==t&&i.push(o[r]);return i.length?n[e]=i:delete n[e],this}};var d=i,m=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o){var i=!1;if("object"===n(t)&&(e.exports=o(),i=!0),!i){var r=window.Cookies,a=window.Cookies=o();a.noConflict=function(){return window.Cookies=r,a}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function t(n){function o(t,i,r){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(r=e({path:"/"},o.defaults,r)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*r.expires),r.expires=s}try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(e){}return i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",i,r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}t||(a={});for(var u=document.cookie?document.cookie.split("; "):[],c=/(%[0-9A-Z]{2})+/g,l=0;l<u.length;l++){var f=u[l].split("="),p=f.slice(1).join("=");'"'===p.charAt(0)&&(p=p.slice(1,-1));try{var h=f[0].replace(c,decodeURIComponent);if(p=n.read?n.read(p,h):n(p,h)||p.replace(c,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(t===h){a=p;break}t||(a[h]=p)}catch(e){}}return a}}return o.set=o,o.get=function(e){return o.call(o,e)},o.getJSON=function(){return o.apply({json:!0},[].slice.call(arguments))},o.defaults={},o.remove=function(t,n){o(t,"",e(n,{expires:-1}))},o.withConverter=t,o}return t(function(){})})}),v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),g={baseUrl:"https://app.featureflow.io",rtmUrl:"https://rtm.featureflow.io",streaming:!0,defaultFeatures:{},useCookies:!0},b=new Error("init() has not been called with a valid apiKey"),w=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(r(this,e),this.receivedInitialResponse=!1,this.emitter=new d,this.apiKey=t,!this.apiKey)throw b;this.config=v({},g,i),this.updateContext(n),this.config.streaming&&(new window.EventSource(this.config.rtmUrl+"/api/js/v1/stream/"+this.apiKey).onmessage=function(e){var t=[];try{t=JSON.parse(e.data)}catch(e){}l.getFeatures(o.config.baseUrl,o.apiKey,o.context,t,function(e,t){e?(o.emitter.emit(h.ERROR,e),a(e)):(o.features=v({},o.features,t),s(o.apiKey,o.context.key,o.features),o.emitter.emit(h.UPDATED_FEATURE,t),a(void 0,t))})}),this.on=this.emitter.on.bind(this.emitter),this.off=this.emitter.off.bind(this.emitter)}return y(e,[{key:"updateContext",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.context={key:t.key||this.getAnonymousKey(),values:t.values},this.features=a(this.apiKey,this.context.key),setTimeout(function(){e.emitter.emit(h.LOADED_FROM_CACHE,e.features),l.getFeatures(e.config.baseUrl,e.apiKey,e.context,[],function(t,o){return e.receivedInitialResponse=!0,t?(e.emitter.emit(h.ERROR,t),n(t)):(e.features=o||{},s(e.apiKey,e.context.key,e.features),e.emitter.emit(h.INIT,o),e.emitter.emit(h.LOADED,o),n(void 0,o)),e.context})},0)}},{key:"getFeatures",value:function(){return this.features}},{key:"getContext",value:function(){return this.context}},{key:"evaluate",value:function(e){var t=new p(this.features[e]||this.config.defaultFeatures[e]||"off");return l.postEvaluateEvent(this.config.baseUrl,this.apiKey,this.context.key,e,t.value(),function(){}),t}},{key:"goal",value:function(e){return l.postGoalEvent(this.config.baseUrl,this.apiKey,this.context.key,e,this.getFeatures(),function(){})}},{key:"getAnonymousKey",value:function(){return localStorage.getItem("ff-anonymous-key")||this.resetAnonymousKey()}},{key:"resetAnonymousKey",value:function(){var e="anonymous:"+Math.random().toString(36).substring(10);return localStorage.setItem("ff-anonymous-key",e),this.config.useCookies&&m.set("ff-anonymous-key",e),e}},{key:"hasReceivedInitialResponse",value:function(){return this.receivedInitialResponse}}]),e}(),k=h,E={init:u,events:k};void 0!==window.VERSION&&(module.exports.version=window.VERSION),e.init=u,e.events=k,e.default=E}(this.Featureflow=this.Featureflow||{});
